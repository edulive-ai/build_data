<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω C√¢u h·ªèi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>C√¥ng C·ª• X·ª≠ L√Ω Data PDF</h1>
            <div class="nav-tabs">
                <button id="uploadPDFBtn" class="tab-btn">üì§ Upload PDF</button>
                <a href="/gallery" class="tab-btn">üñºÔ∏è View Gallery</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content-3col">
            <!-- Form Section -->
            <div class="form-section">
                <h2 class="section-title">Th√™m C√¢u H·ªèi M·ªõi</h2>
                
                <!-- Book Selection -->
                <div class="form-group">
                    <label for="bookSelect">Ch·ªçn s√°ch:</label>
                    <select id="bookSelect" class="book-select" onchange="onBookChange()">
                        <option value="cropped">S√°ch m·∫∑c ƒë·ªãnh (cropped)</option>
                    </select>
                </div>
                
                <form id="questionForm">
                    <div class="form-group">
                        <label for="subject">M√¥n h·ªçc:</label>
                        <input type="text" id="subject" name="subject" required>
                    </div>

                    <div class="form-group">
                        <label for="chapter">Ch∆∞∆°ng:</label>
                        <input type="text" id="chapter" name="chapter" required>
                    </div>

                    <div class="form-group">
                        <label for="lesson">B√†i h·ªçc:</label>
                        <input type="text" id="lesson" name="lesson" required>
                    </div>

                    <div class="form-group">
                        <label for="difficulty">ƒê·ªô kh√≥:</label>
                        <select id="difficulty" name="difficulty" required>
                            <option value="easy">D·ªÖ</option>
                            <option value="medium">Trung b√¨nh</option>
                            <option value="hard">Kh√≥</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="question">C√¢u h·ªèi:</label>
                        <textarea id="question" name="question" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="answer">ƒê√°p √°n:</label>
                        <textarea id="answer" name="answer" required></textarea>
                    </div>

                    <!-- Folder Selection -->
                    <div class="form-group">
                        <label for="folderSelect">Ch·ªçn folder ·∫£nh:</label>
                        <select id="folderSelect" class="folder-select" onchange="loadImagesFromFolder()">
                            <option value="">-- Ch·ªçn folder ·∫£nh --</option>
                        </select>
                    </div>
                    <!-- Text Content Display -->
                    <div class="form-group" id="textContentGroup" style="display: none;">
                        <label for="textContent">N·ªôi dung ocr:</label>
                        <div class="text-content-header">
                            <button type="button" id="editTextBtn" class="btn btn-secondary btn-small">Ch·ªânh s·ª≠a</button>
                            <button type="button" id="saveTextBtn" class="btn btn-success btn-small" style="display: none;">L∆∞u</button>
                            <button type="button" id="cancelTextBtn" class="btn btn-secondary btn-small" style="display: none;">H·ªßy</button>
                        </div>
                        <div id="textDisplay" class="text-display"></div>
                        <textarea id="textEditor" class="text-editor" style="display: none;"></textarea>
                    </div>

                    <!-- Image Selection Controls -->
                    <div class="form-group">
                        <label>Ch·ªçn h√¨nh ·∫£nh:</label>
                        <div class="selection-buttons">
                            <button type="button" id="selectQuestionMode" class="btn btn-success">Ch·ªçn ·∫£nh C√¢u h·ªèi</button>
                            <button type="button" id="selectAnswerMode" class="btn btn-warning">Ch·ªçn ·∫£nh ƒê√°p √°n</button>
                            <button type="button" id="clearSelection" class="btn btn-secondary">X√≥a ch·ªçn</button>
                        </div>
                        
                        <!-- Images Grid -->
                        <div id="imagesGrid" class="images-grid">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Th√™m C√¢u h·ªèi</button>
                </form>
            </div>

            <!-- Questions List Section -->
            <div class="questions-section">
                <h2 class="section-title">Danh S√°ch C√¢u H·ªèi</h2>
                <div id="questionsList" class="questions-list"></div>
            </div>

            <!-- JSON Viewer Section -->
            <div class="json-viewer-section">
                <div class="json-header">
                    <h2 class="section-title">Json Editor</h2>
                    <div class="json-controls">
                        <button id="loadJsonBtn" class="btn btn-primary">T·∫£i JSON</button>
                        <button id="saveJsonBtn" class="btn btn-success">L∆∞u JSON</button>
                    </div>
                </div>
                
                
                <div class="json-editor-container">
                    <textarea id="jsonEditor" class="json-editor" placeholder="N·ªôi dung JSON s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload PDF Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üì§ Upload v√† X·ª≠ l√Ω PDF</h2>
            
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="pdfFile">Ch·ªçn file PDF:</label>
                    <input type="file" id="pdfFile" name="pdf_file" accept=".pdf" required>
                    
                    <div id="fileInfo" class="file-info" style="display: none;">
                        <p><strong>T√™n file:</strong> <span id="fileName"></span></p>
                        <p><strong>K√≠ch th∆∞·ªõc:</strong> <span id="fileSize"></span></p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bookName">T√™n s√°ch:</label>
                    <input type="text" id="bookName" name="book_name" placeholder="V√≠ d·ª•: toan-lop-1" pattern="[a-zA-Z0-9_-]+" required>
                    <small>Ch·ªâ s·ª≠ d·ª•ng ch·ªØ c√°i, s·ªë, d·∫•u g·∫°ch d∆∞·ªõi (_) v√† g·∫°ch ngang (-)</small>
                </div>

                <!-- Progress Bar -->
                <div id="uploadProgress" class="upload-progress" style="display: none;">
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                    <div id="progressText" class="progress-text">ƒêang upload...</div>
                </div>

                <div class="upload-info">
                    <h3>Qu√° tr√¨nh x·ª≠ l√Ω bao g·ªìm:</h3>
                    <ol>
                        <li>üìÑ Chuy·ªÉn ƒë·ªïi PDF th√†nh ·∫£nh (300 DPI)</li>
                        <li>ü§ñ YOLO detection ƒë·ªÉ t√°ch c√¢u h·ªèi v√† ƒë√°p √°n</li>
                        <li>üîç OCR ƒë·ªÉ nh·∫≠n di·ªán text t·ª´ ·∫£nh</li>
                    </ol>
                    <p><strong>L∆∞u √Ω:</strong> File PDF t·ªëi ƒëa 100MB. Qu√° tr√¨nh x·ª≠ l√Ω c√≥ th·ªÉ m·∫•t v√†i ph√∫t t√πy thu·ªôc v√†o s·ªë trang.</p>
                </div>

                <div class="modal-buttons">
                    <button type="submit" id="submitUpload" class="btn btn-primary">B·∫Øt ƒë·∫ßu x·ª≠ l√Ω</button>
                    <button type="button" id="cancelUpload" class="btn btn-secondary">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ch·ªânh s·ª≠a C√¢u h·ªèi</h2>
            
            <form id="editForm">
                <div class="form-group">
                    <label for="editSubject">M√¥n h·ªçc:</label>
                    <input type="text" id="editSubject" name="subject" required>
                </div>

                <div class="form-group">
                    <label for="editChapter">Ch∆∞∆°ng:</label>
                    <input type="text" id="editChapter" name="chapter" required>
                </div>

                <div class="form-group">
                    <label for="editLesson">B√†i h·ªçc:</label>
                    <input type="text" id="editLesson" name="lesson" required>
                </div>

                <div class="form-group">
                    <label for="editDifficulty">ƒê·ªô kh√≥:</label>
                    <select id="editDifficulty" name="difficulty" required>
                        <option value="easy">D·ªÖ</option>
                        <option value="medium">Trung b√¨nh</option>
                        <option value="hard">Kh√≥</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editQuestion">C√¢u h·ªèi:</label>
                    <textarea id="editQuestion" name="question" required></textarea>
                </div>

                <div class="form-group">
                    <label for="editAnswer">ƒê√°p √°n:</label>
                    <textarea id="editAnswer" name="answer" required></textarea>
                </div>

                <!-- Edit Folder Selection -->
                <div class="form-group">
                    <label for="editFolderSelect">Ch·ªçn folder ·∫£nh:</label>
                    <select id="editFolderSelect" class="folder-select" onchange="loadImagesFromFolderForEdit(this.value)">
                        <option value="">-- Ch·ªçn folder ·∫£nh --</option>
                    </select>
                </div>
                <div class="form-group" id="editTextContentGroup" style="display: none;">
                    <label for="editTextContent">N·ªôi dung text.txt:</label>
                    <div class="text-content-header">
                        <button type="button" id="editTextBtnModal" class="btn btn-secondary btn-small">Ch·ªânh s·ª≠a</button>
                        <button type="button" id="saveTextBtnModal" class="btn btn-success btn-small" style="display: none;">L∆∞u</button>
                        <button type="button" id="cancelTextBtnModal" class="btn btn-secondary btn-small" style="display: none;">H·ªßy</button>
                    </div>
                    <div id="editTextDisplay" class="text-display"></div>
                    <textarea id="editTextEditor" class="text-editor" style="display: none;"></textarea>
                </div>

                <!-- Edit Image Selection Controls -->
                <div class="form-group">
                    <label>Ch·ªçn h√¨nh ·∫£nh:</label>
                    <div class="selection-buttons">
                        <button type="button" id="editSelectQuestionMode" class="btn btn-success">Ch·ªçn ·∫£nh C√¢u h·ªèi</button>
                        <button type="button" id="editSelectAnswerMode" class="btn btn-warning">Ch·ªçn ·∫£nh ƒê√°p √°n</button>
                        <button type="button" id="editClearSelection" class="btn btn-secondary">X√≥a ch·ªçn</button>
                    </div>
                    
                    <!-- Edit Images Grid -->
                    <div id="editImagesGrid" class="images-grid">
                        <p class="no-images">Vui l√≤ng ch·ªçn folder ·∫£nh</p>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                    <button type="button" id="cancelEdit" class="btn btn-secondary">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" class="modal">
        <div class="modal-content image-preview-modal">
            <span class="close">&times;</span>
            <div class="image-preview-container">
                <img id="previewImage" src="" alt="Preview">
                <div class="image-info">
                    <p id="imagePath"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>